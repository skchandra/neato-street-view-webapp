<!doctype html>
<html>
  <head>
  <script src='javascripts/sql.js'></script>

  <script>
    // window.onload = initLinks;

    var thisPic = 15;

    var xhr = new XMLHttpRequest();
    xhr.open('GET', '/PanoramaDatabase.db',  true);
    xhr.responseType = 'arraybuffer';

    xhr.onload = function(e) {
      var uInt8Array = new Uint8Array(this.response);
      db = new SQL.Database(uInt8Array);
      // var contents = db.exec("SELECT * FROM panoramaIter1");
      // contents is now [{columns:['col1','col2',...], values:[[first row], [second row], ...]}]
    };
    xhr.send();

    // function initLinks() {
    //   document.getElementById("prevLink").onclick = processPrevious;
    //   document.getElementById("nextLink").onclick = processNext;
    // }

    function processPrevious(x, y, theta) {
      deg = theta -1;
      // FIXME: 27 is hardcoded
      if (deg<1){
        deg = 27;
      }
      showDiv(x, y, deg);
    }

    function processNext(x, y, theta) {
      deg = theta +1;
      // FIXME: 27 is hardcoded
      if (deg>27){
        deg = 1;
      }
      showDiv(x, y, deg);
    }

    function changePanorama (x, y, theta) {
      document.getElementById("prevLink").onclick = function() {processPrevious(x, y, theta);};
      document.getElementById("nextLink").onclick = function() {processNext(x, y, theta);};
    }

    function showDiv(x, y, theta) {
      var stmt = db.prepare("SELECT * FROM panoramaIter1 WHERE x=$x AND y=$y AND deg=$deg");
      var obj = stmt.getAsObject({$x: x, $y: y, $deg: theta}); // {col1:1, col2:111}
      // res = /images/0.0,0.0,0.0.jpg
      document.getElementById('panorama').src = obj.Address;
      document.getElementById('panoramaDiv').style.display = "block";
      document.getElementById('map').style.display = "none";
      changePanorama(x, y, theta);
    }

    function showMap() {
      document.getElementById('map').style.display = "block";
      document.getElementById('panoramaDiv').style.display = "none";
    }
  </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Neato Street View</title>

    <!-- <link rel="stylesheet" href="stylesheets/styles.css"> -->
    <!-- <link rel="stylesheet" href="stylesheets/github-light.css"> -->
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Neato Street View - Computational Robotics Fall 2015 Final Project</h1>
        <p class="header"></p>
      </header>
     
      <div id="map" style="display:block" align="center">
          <img src="images/ac4.png" alt="AC Fourth Floor"

          usemap="#map">

          <map name="map">
          <area id="waypoint" shape="circle" coords="78,25,12" onclick="showDiv(1, 2, 1)" alt="1">
          <area id="waypoint" shape="circle" coords="93,78,12" onclick="showDiv(1, 2, 1)" alt="2">
          <area id="waypoint" shape="circle" coords="109,118,12" onclick="showDiv(1, 2, 1)" alt="3">
          <area id="waypoint" shape="circle" coords="125,160,12" onclick="showDiv(1, 2, 1)" alt="4">
          <area id="waypoint" shape="circle" coords="146,200,12" onclick="showDiv(1, 2, 1)" alt="5">
          <area id="waypoint" shape="circle" coords="163,240,12" onclick="showDiv(1, 2, 1)" alt="6">
          <area id="waypoint" shape="circle" coords="186,286,12" onclick="showDiv(1, 2, 1)" alt="7">
          <area id="waypoint" shape="circle" coords="211,331,12" onclick="showDiv(1, 2, 1)" alt="8">
          <area id="waypoint" shape="circle" coords="240,372,12" onclick="showDiv(1, 2, 1)" alt="9">
          <area id="waypoint" shape="circle" coords="274,418,12" onclick="showDiv(1, 2, 1)" alt="10">
          <area id="waypoint" shape="circle" coords="305,457,12" onclick="showDiv(1, 2, 1)" alt="11">
          <area id="waypoint" shape="circle" coords="338,502,12" onclick="showDiv(1, 2, 1)" alt="12">
          <area id="waypoint" shape="circle" coords="365,548,12" onclick="showDiv(1, 2, 1)" alt="13">
          <area id="waypoint" shape="circle" coords="389,599,12" onclick="showDiv(1, 2, 1)" alt="14">
          <area id="waypoint" shape="circle" coords="408,644,12" onclick="showDiv(1, 2, 1)" alt="15">
          <area id="waypoint" shape="circle" coords="423,679,12" onclick="showDiv(1, 2, 1)" alt="16">
          <area id="waypoint" shape="circle" coords="279,469,12" onclick="showDiv(1, 2, 1)" alt="17">
          </map>
        </div>
        <div id="panoramaDiv"  style="display:none; width:100%" align="center">
          <button><img src="images/left_arrow.png" width="40" id="prevLink"</button>
          <img id="panorama" src="" alt="waypoint" width="1350" height="800">
          <button><img src="images/right_arrow.png" width="40" id="nextLink"></button>
          <button onclick="showMap()">Return to map</button>
        </div>
        
  </body>
</html>